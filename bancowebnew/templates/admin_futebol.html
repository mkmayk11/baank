{% extends "base.html" %}
{% block conteudo %}
<div class="container py-4">

    <h2 class="mb-4">⚽ Admin Futebol</h2>

    <!-- Formulário para adicionar jogo -->
    <div class="card mb-4 shadow-sm">
        <div class="card-body">
            <h5 class="card-title">Adicionar novo jogo</h5>
            <form method="POST">
                <div class="row g-2">
                    <div class="col-md-3">
                        <input type="text" name="time1" class="form-control" placeholder="Time 1" required>
                    </div>
                    <div class="col-md-3">
                        <input type="text" name="time2" class="form-control" placeholder="Time 2" required>
                    </div>
                    <div class="col-md-2">
                        <input type="number" step="0.01" min="1" name="odds1" class="form-control" placeholder="Odd Time 1" required>
                    </div>
                    <div class="col-md-2">
                        <input type="number" step="0.01" min="1" name="odds_empate" class="form-control" placeholder="Odd Empate" required>
                    </div>
                    <div class="col-md-2">
                        <input type="number" step="0.01" min="1" name="odds2" class="form-control" placeholder="Odd Time 2" required>
                    </div>
                </div>

                <div class="row g-2 mt-2">
                    <div class="col-md-3">
                        <input type="number" step="0.01" min="1" name="odd_resultado" class="form-control" placeholder="Odd Resultado (opcional)">
                    </div>
                    <div class="col-md-3">
                        <input type="number" step="0.01" min="1" name="odd_gols" class="form-control" placeholder="Odd Gols (opcional)">
                    </div>
                    <div class="col-md-3">
                        <input type="number" step="0.01" min="1" name="odd_cartoes" class="form-control" placeholder="Odd Cartões (opcional)">
                    </div>
                    <div class="col-md-3">
                        <input type="number" step="0.01" min="1" name="odd_expulsoes" class="form-control" placeholder="Odd Expulsões (opcional)">
                    </div>
                </div>

                <div class="row mt-3">
                    <div class="col-md-2">
                        <button type="submit" class="btn btn-success w-100">Adicionar Jogo</button>
                    </div>
                </div>
            </form>
        </div>
    </div>

    <!-- Jogos cadastrados -->
    <h4>Jogos cadastrados</h4>
    {% if jogos %}
        <div class="accordion" id="accordionJogos">
            {% for jogo in jogos %}
                <div class="accordion-item mb-2">
                    <h2 class="accordion-header" id="heading{{ jogo.id }}">
                        <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapse{{ jogo.id }}" aria-expanded="false" aria-controls="collapse{{ jogo.id }}">
                            {{ jogo.time1 }} x {{ jogo.time2 }} {% if not jogo.ativo %} (Inativo) {% endif %}
                        </button>
                    </h2>
                    <div id="collapse{{ jogo.id }}" class="accordion-collapse collapse" aria-labelledby="heading{{ jogo.id }}" data-bs-parent="#accordionJogos">
                        <div class="accordion-body">
                            <ul class="list-group">
                                {% for m in jogo.mercados %}
                                    <li class="list-group-item d-flex justify-content-between align-items-center">
                                        {{ m.nome }}: {{ m.odd }}
                                        <a href="{{ url_for('deletar_mercado', mercado_id=m.id) }}" class="btn btn-sm btn-danger">Deletar</a>
                                    </li>
                                {% endfor %}
                            </ul>
                            <div class="mt-2">
                                <a href="{{ url_for('deletar_jogo', jogo_id=jogo.id) }}" class="btn btn-sm btn-danger">Deletar Jogo</a>
                                {% if jogo.ativo %}
                                    <a href="{{ url_for('toggle_jogo', jogo_id=jogo.id) }}" class="btn btn-sm btn-warning">Desativar</a>
                                {% else %}
                                    <a href="{{ url_for('toggle_jogo', jogo_id=jogo.id) }}" class="btn btn-sm btn-success">Ativar</a>
                                {% endif %}
                            </div>
                        </div>
                    </div>
                </div>
            {% endfor %}
        </div>
    {% else %}
        <p class="text-muted">Nenhum jogo cadastrado.</p>
    {% endif %}

    <!-- Apostas recentes -->
    <h4 class="mt-4">Apostas recentes</h4>
    {% if apostas %}
        <div class="table-responsive">
            <table class="table table-striped table-bordered">
                <thead>
                    <tr>
                        <th>Usuário</th>
                        <th>Valor Apostado</th>
                        <th>Jogo</th>
                        <th>Mercado</th>
                        <th>Odd</th>
                        <th>Resultado</th>
                    </tr>
                </thead>
                <tbody>
                    {% for a in apostas %}
                        <tr>
                            <td>{{ a.usuario }}</td>
                            <td>{{ a.valor_mercado or a.valor }}</td>
                            <td>{{ a.time1 }} x {{ a.time2 }}</td>
                            <td>{{ a.mercado_nome }}</td>
                            <td>{{ a.valor_mercado }}</td>
                            <td>{{ a.resultado or "Pendente" }}</td>
                        </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
    {% else %}
        <p class="text-muted">Nenhuma aposta registrada ainda.</p>
    {% endif %}

</div>
{% endblock %}
