{% extends "base.html" %}
{% block conteudo %}
<div class="casino-background py-5">
  <div class="container">
    <div class="row justify-content-center g-4">

      <!-- 🎰 CAÇA-NÍQUEL -->
      <div class="col-md-6">
        <div class="card p-4 text-center shadow-lg slot-card">
          <h2 class="mb-3">🎰 Caça-Níquel</h2>
          <form method="POST" action="{{ url_for('jogos') }}">
            <input type="number" name="aposta_caca" id="apostaCaca" step="0.01"
              value="{{ last_aposta_caca }}" placeholder="Valor da aposta" required class="form-control mb-2">
            <input type="number" name="lote" id="lote" value="{{ last_lote }}"
              placeholder="Qtd rodadas (opcional)" class="form-control mb-3">

            <button type="submit" class="btn btn-neon w-100">Girar 🎰</button>
          </form>

          <div id="slotMachine" class="slot-machine mt-4">
            <div class="reel" id="reel1"></div>
            <div class="reel" id="reel2"></div>
            <div class="reel" id="reel3"></div>
          </div>

          {% if resultado_caca %}
            <div class="alert alert-info mt-3">{{ resultado_caca }}</div>
          {% endif %}
        </div>
      </div>

      <!-- 🎡 ROLETA -->
      <div class="col-md-6">
        <div class="card p-4 text-center shadow-lg roulette-card">
          <h2 class="mb-3">🎡 Roleta</h2>
          <form method="POST" action="{{ url_for('jogar_roleta') }}">
            <input type="number" name="aposta_roleta" id="apostaRoleta" step="0.01"
              value="{{ last_aposta_roleta }}" placeholder="Valor da aposta" required class="form-control mb-3">
            <button type="submit" class="btn btn-neon w-100">Rodar 🎡</button>
          </form>

          <div class="roulette-container mt-4">
            <canvas id="rouletteCanvas" width="300" height="300"></canvas>
            <div id="rouletteResult" class="mt-3"></div>
          </div>
        </div>
      </div>

    </div>
  </div>
</div>

<style>
  body {
    background: radial-gradient(circle at center, #111 0%, #000 100%);
    color: #fff;
  }
  .card {
    border-radius: 20px;
    background: rgba(20,20,20,0.95);
    border: 1px solid #444;
  }
  .btn-neon {
    background: linear-gradient(45deg, #0ff, #0f0);
    color: #000;
    font-weight: bold;
    border-radius: 12px;
    transition: 0.2s;
  }
  .btn-neon:hover {
    transform: scale(1.05);
    box-shadow: 0 0 20px #0f0;
  }

  /* 🎰 SLOT MACHINE */
  .slot-machine {
    display: flex;
    justify-content: center;
    gap: 10px;
  }
  .reel {
    width: 70px;
    height: 70px;
    background: #111;
    border: 2px solid #0f0;
    border-radius: 10px;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 2.2rem;
    color: #0f0;
    box-shadow: inset 0 0 10px #0f0;
  }

  /* 🎡 ROLETA */
  .roulette-container {
    position: relative;
    margin: auto;
  }
  #rouletteCanvas {
    border-radius: 50%;
    border: 5px solid #0f0;
    box-shadow: 0 0 20px #0f0;
  }
</style>

<script>
  // 🎰 Slot Machine
  const symbols = [
    "⭐","🍒","🍋","7️⃣","🎲","🔔","💎","🍇",
    "🍉","🍌","🍓","🍀","🍍","🥭","🥝","🍈"
  ];

  function spinReel(reelId, delay) {
    return new Promise(resolve => {
      const reel = document.getElementById(reelId);
      let i = 0;
      const interval = setInterval(() => {
        reel.textContent = symbols[i % symbols.length];
        i++;
      }, 100);
      setTimeout(() => {
        clearInterval(interval);
        const finalSymbol = symbols[Math.floor(Math.random() * symbols.length)];
        reel.textContent = finalSymbol;
        resolve(finalSymbol);
      }, delay);
    });
  }

  async function startSlot() {
    const s1 = await spinReel("reel1", 1500);
    const s2 = await spinReel("reel2", 2500);
    const s3 = await spinReel("reel3", 3500);
  }

  document.querySelector("form[action*='jogar_caca']")
    .addEventListener("submit", e => {
      e.preventDefault();
      startSlot();
      e.target.submit();
    });

  // 🎡 Roleta
  const canvas = document.getElementById("rouletteCanvas");
  const ctx = canvas.getContext("2d");
  const segments = symbols; // mesma lista do caça
  const colors = [
    "#0f0","#0ff","#ff0","#f0f",
    "#f90","#09f","#fa0","#0fa",
    "#ff5","#5ff","#f55","#5f5",
    "#55f","#f5f","#0cf","#cf0"
  ];
  let angle = 0, spinning = false;

  function drawRoulette() {
    const radius = canvas.width / 2;
    const segmentAngle = (2 * Math.PI) / segments.length;
    for (let i = 0; i < segments.length; i++) {
      ctx.beginPath();
      ctx.moveTo(radius, radius);
      ctx.arc(radius, radius, radius, i * segmentAngle, (i + 1) * segmentAngle);
      ctx.fillStyle = colors[i % colors.length];
      ctx.fill();
      ctx.save();
      ctx.translate(radius, radius);
      ctx.rotate(i * segmentAngle + segmentAngle / 2);
      ctx.fillStyle = "#000";
      ctx.font = "20px Arial";
      ctx.textAlign = "center";
      ctx.fillText(segments[i], radius * 0.65, 5);
      ctx.restore();
    }
  }

  function spinRoulette() {
    if (spinning) return;
    spinning = true;
    let speed = Math.random() * 0.3 + 0.25;
    const slowDown = 0.995;
    function animate() {
      ctx.clearRect(0, 0, canvas.width, canvas.height);
      ctx.save();
      ctx.translate(canvas.width / 2, canvas.height / 2);
      ctx.rotate(angle);
      ctx.translate(-canvas.width / 2, -canvas.height / 2);
      drawRoulette();
      ctx.restore();
      angle += speed;
      speed *= slowDown;
      if (speed < 0.002) {
        spinning = false;
        const winningIndex = Math.floor(((2 * Math.PI - angle) % (2 * Math.PI)) / ((2 * Math.PI) / segments.length));
        document.getElementById("rouletteResult").innerText = "Resultado: " + segments[winningIndex];
      } else {
        requestAnimationFrame(animate);
      }
    }
    animate();
  }

  document.querySelector("form[action*='jogar_roleta']")
    .addEventListener("submit", e => {
      e.preventDefault();
      spinRoulette();
      e.target.submit();
    });

  drawRoulette();
</script>
{% endblock %}

