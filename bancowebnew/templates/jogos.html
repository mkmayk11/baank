{% extends "base.html" %}
{% block conteudo %}
<div class="casino-background py-5">
  <div class="container">
    <div class="d-flex justify-content-between align-items-start mb-3">
      <h2 class="text-white">🎲 Maask Cassino 🎲</h2>
      <div id="saldoBox" class="px-3 py-2" style="background: rgba(0,0,0,0.4); border-radius:12px; border:1px solid #2f2">
        <strong>Saldo:</strong> R$ {{ '%.2f' % (saldo or 0) }}
      </div>
    </div>

    <div class="row justify-content-center g-4">
      <!-- 🎰 CAÇA-NÍQUEL -->
      <div class="col-md-6 position-relative text-center">

        <!-- TABELA DE PRÊMIOS - AGORA CENTRALIZADA E RESPONSIVA -->
        <div class="card p-3 mb-3 shadow-lg mx-auto" style="background: rgba(0,0,0,0.8); border:1px solid #0f0; border-radius:12px; max-width: 300px;">
          <h5 class="text-white mb-2">🏆 Premiação dos Emojis</h5>
          <table class="table table-sm text-white mb-0">
            <thead>
              <tr>
                <th>Emoji</th>
                <th>Prêmio</th>
              </tr>
            </thead>
            <tbody>
              <tr><td>🍒</td><td>par = x6, trio = x30</td></tr>
              <tr><td>🍀</td><td>par = 10 rodadas, trio = x50 + 20 rodadas</td></tr>
              <tr><td>🎲</td><td>par = x50, trio = x130</td></tr>
              <tr><td>⭐</td><td>par = x80, trio = x250</td></tr>
              <tr><td>💸</td><td>par = x70, trio = x160</td></tr>
            </tbody>
          </table>
        </div>

        <!-- MÁQUINA DE SLOT -->
<div class="card p-4 text-center shadow-lg slot-card">
  <h2 class="mb-3">🎰 Caça-Níquel 5x</h2>
  <form id="formCaca">
    <input type="number" name="aposta_caca" id="apostaCaca" step="0.01" value="{{ last_aposta_caca or 0 }}" placeholder="Valor da aposta" required class="form-control mb-2">
    <input type="number" name="lote" id="lote" value="{{ last_lote or 1 }}" placeholder="Qtd rodadas (opcional)" class="form-control mb-3">
    <button type="submit" class="btn btn-neon w-100">Girar 🎰</button>
  </form>

  <div id="slotMachine" class="slot-machine mt-4">
    <!-- 🔥 5 rolos agora -->
    <div class="reel" id="reel1">❔</div>
    <div class="reel" id="reel2">❔</div>
    <div class="reel" id="reel3">❔</div>
    <div class="reel" id="reel4">❔</div>
    <div class="reel" id="reel5">❔</div>
  </div>

  <div id="slotResultado" class="alert alert-info mt-3" style="display:none;"></div>
  <div id="rodadasRestantes" class="text-white mt-2" style="font-size:0.9rem;"></div>

  <div id="historicoSlot" class="mt-3 text-white" style="font-size:0.9rem; background: rgba(0,0,0,0.3); border-radius:10px; padding:8px;">
    <h6>🎰 Últimos giros:</h6>
    <ul id="listaHistorico" style="list-style:none; padding-left:0; margin:0;"></ul>
  </div>
</div>

      <!-- 🎡 ROLETA -->
      <div class="col-md-6">
        <div class="card p-4 text-center shadow-lg roulette-card">
          <h2 class="mb-3">🎡 Roleta</h2>
          <form id="formRoleta">
            <input type="number" name="aposta_roleta" id="apostaRoleta" step="0.01" value="{{ last_aposta_roleta or 0 }}" placeholder="Valor da aposta" required class="form-control mb-2">
            <input type="number" name="numero_roleta" id="numeroAposta" min="0" max="20" value="{{ last_numero_aposta or 0 }}" placeholder="Número apostado (0-20)" class="form-control mb-3">
            <button type="submit" class="btn btn-neon w-100">Rodar 🎡</button>
          </form>

          <div class="roulette-container mt-4">
            <div class="roulette-wrapper">
              <canvas id="rouletteCanvas" width="300" height="300"></canvas>
              <div class="roulette-pointer">▼</div>
            </div>
            <div id="rouletteResult" class="mt-3 text-white"></div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- 🔊 BOTÃO DE ATIVAR SOM -->
<button id="ativarSom" style="position:fixed; top:15px; right:15px; z-index:9999; padding:8px 14px; border:none; background:#0f0; color:#000; font-weight:bold; border-radius:8px; cursor:pointer; box-shadow:0 0 10px #0f0;">
  🔊 Ativar Som
</button>

<script>
  const sounds = {
    slot: "https://cdn.pixabay.com/audio/2022/03/15/audio_4c00a92f2a.mp3",
    roulette: "https://cdn.pixabay.com/audio/2022/03/15/audio_4c00a92f2a.mp3",
    win: "https://cdn.pixabay.com/audio/2022/03/15/audio_2e836e3a0c.mp3",
    lose: "https://cdn.pixabay.com/audio/2022/03/15/audio_7b06f04342.mp3"
  };
  let soundEnabled = false;
  function playSound(url, volume = 0.6) {
    if (!soundEnabled) return;
    const audio = new Audio(url);
    audio.volume = volume;
    audio.play().catch(()=>{});
  }
  document.getElementById("ativarSom").addEventListener("click", () => {
    soundEnabled = true;
    playSound(sounds.win, 0.1);
    document.getElementById("ativarSom").style.display = "none";
  });

  const symbols = ["🍒","🍋","🔔","⭐","💎","🍀","🍉","🥭","🍇","🍌","🍓","🍑","🍍","🥝","🥥","🍈","🌈","🎲","🏺","💸","☀️","🚀","🌶️","🥕","🎃"];
  let rodadasGratis = {{ rodadas_gratis or 0 }};
</script>

{% endblock %}
