{% extends "base.html" %}
{% block conteudo %}
<div class="container py-5" style="min-height:100vh; background: radial-gradient(circle at center, #111, #000); color:#fff;">
    <h2 class="text-center mb-5" style="color:#00ff88;">âš½ Apostas de Futebol</h2>

    <div class="row g-4 justify-content-center">

        {% for jogo in jogos %}
        <div class="col-md-6 col-lg-4">
            <div class="card game-card shadow-lg p-3" data-id="{{ jogo.id }}">
                <h4 class="text-center fw-bold mb-3">{{ jogo.time1 }} vs {{ jogo.time2 }}</h4>

                <div class="d-flex justify-content-between mb-3">
                    <label class="form-check-label fw-bold">
                        <input type="radio" name="vencedor_{{ jogo.id }}" value="time1">
                        {{ jogo.time1 }} <span class="odds">x{{ jogo.odds1 }}</span>
                    </label>
                    <label class="form-check-label fw-bold">
                        <input type="radio" name="vencedor_{{ jogo.id }}" value="empate">
                        Empate <span class="odds">x{{ jogo.odds_empate }}</span>
                    </label>
                    <label class="form-check-label fw-bold">
                        <input type="radio" name="vencedor_{{ jogo.id }}" value="time2">
                        {{ jogo.time2 }} <span class="odds">x{{ jogo.odds2 }}</span>
                    </label>
                </div>

                <input type="number" step="0.01" min="1" class="form-control mb-2" name="valor_{{ jogo.id }}" placeholder="Valor da aposta">

                <button class="btn btn-neon w-100 btn-apostar" data-id="{{ jogo.id }}">ðŸ’° Apostar</button>

                <div class="resultado mt-2 text-center" style="display:none;"></div>
            </div>
        </div>
        {% endfor %}

    </div>
</div>

<style>
    .game-card {
        background: rgba(30,30,30,0.95);
        border: 1px solid #0f0;
        border-radius: 16px;
        transition: transform 0.3s, box-shadow 0.3s;
    }
    .game-card:hover {
        transform: translateY(-5px);
        box-shadow: 0 0 25px #00ff88;
    }
    .odds {
        color: #ff0;
        font-weight: bold;
        margin-left: 5px;
    }
    .btn-neon {
        background: linear-gradient(45deg, #00ff88, #00bfa5);
        color: #000;
        font-weight: bold;
        border-radius: 12px;
        transition: 0.2s;
    }
    .btn-neon:hover {
        transform: scale(1.05);
        box-shadow: 0 0 20px #00ff88;
    }
    input[type=radio] {
        margin-right: 5px;
    }
</style>

<script>
document.querySelectorAll(".btn-apostar").forEach(btn=>{
    btn.addEventListener("click", async ()=>{
        const jogoId = btn.getAttribute("data-id");
        const vencedorInput = document.querySelector(`input[name="vencedor_${jogoId}"]:checked`);
        const valorInput = document.querySelector(`input[name="valor_${jogoId}"]`);

        if(!vencedorInput || !valorInput.value){
            alert("Selecione o vencedor e insira o valor da aposta.");
            return;
        }

        const data = {
            jogo_id: jogoId,
            vencedor: vencedorInput.value,
            valor: parseFloat(valorInput.value)
        };

        const resp = await fetch("{{ url_for('apostar_futebol') }}", {
            method:"POST",
            headers:{"Content-Type":"application/json"},
            body: JSON.stringify(data)
        });

        const result = await resp.json();
        const resultadoDiv = btn.parentElement.querySelector(".resultado");
        resultadoDiv.style.display="block";

        if(result.success){
            resultadoDiv.className="resultado alert alert-success mt-2";
            resultadoDiv.innerText=`Aposta registrada! Novo saldo: R$ ${result.saldo.toFixed(2)}`;
        } else {
            resultadoDiv.className="resultado alert alert-danger mt-2";
            resultadoDiv.innerText=result.mensagem || "Erro ao registrar aposta.";
        }
    });
});
</script>
{% endblock %}
