{% extends "base.html" %}
{% block conteudo %}
<div class="container py-4">
    <h2 class="mb-4">⚽ Jogos Disponíveis para Aposta</h2>
    <p>Saldo disponível: {{ saldo_usuario }}</p>

    {% if jogos %}
        {% for jogo in jogos %}
            <div class="card mb-3 shadow-sm">
                <div class="card-body">
                    <h5 class="card-title">{{ jogo.time1 }} x {{ jogo.time2 }}</h5>

                    <!-- Exibe mercados disponíveis -->
                    {% if jogo.mercados %}
                        <form method="POST" action="{{ url_for('apostar') }}">
                            <input type="hidden" name="jogo_id" value="{{ jogo.id }}">
                            <div class="row g-2">
                                {% for mercado in jogo.mercados %}
                                    <div class="col-md-2">
                                        <div class="form-check">
                                            <input class="form-check-input" type="radio" 
                                                   name="mercado_id" 
                                                   value="{{ mercado.id }}" 
                                                   id="m{{ mercado.id }}" required>
                                            <label class="form-check-label" for="m{{ mercado.id }}">
                                                {{ mercado.nome }}: {{ mercado.odd }}
                                            </label>
                                        </div>
                                    </div>
                                {% endfor %}
                            </div>

                            <div class="row mt-2">
                                <div class="col-md-3">
                                    <input type="number" step="0.01" min="1" name="valor" class="form-control" placeholder="Valor da aposta" required>
                                </div>
                                <div class="col-md-2">
                                    <button type="submit" class="btn btn-primary">Apostar</button>
                                </div>
                            </div>
                        </form>
                    {% else %}
                        <p class="text-muted">Nenhum mercado disponível para este jogo.</p>
                    {% endif %}
                </div>
            </div>
        {% endfor %}
    {% else %}
        <p class="text-muted">Nenhum jogo disponível no momento.</p>
    {% endif %}

    <!-- Histórico rápido de apostas do usuário -->
    <h4 class="mt-5">Suas últimas apostas</h4>
    {% if apostas_usuario %}
        <table class="table table-striped">
            <thead>
                <tr>
                    <th>Jogo</th>
                    <th>Mercado</th>
                    <th>Escolha</th>
                    <th>Valor</th>
                    <th>Status</th>
                    <th>Data</th>
                </tr>
            </thead>
            <tbody>
                {% for ap in apostas_usuario %}
                    <tr>
                        <td>{{ ap.time1 }} x {{ ap.time2 }}</td>
                        <td>{{ ap.mercado_nome or '—' }}</td>
                        <td>{{ ap.escolha }}</td>
                        <td>{{ ap.valor }}</td>
                        <td>{{ ap.resultado or 'pendente' }}</td>
                        <td>{{ ap.criado_em_fmt or '' }}</td>
                    </tr>
                {% endfor %}
            </tbody>
        </table>
    {% else %}
        <p class="text-muted">Você ainda não fez apostas.</p>
    {% endif %}
</div>
{% endblock %}
